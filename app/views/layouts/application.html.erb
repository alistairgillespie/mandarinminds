<!DOCTYPE html>
<html>
<head>
  <title>Mandarin Minds</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
  <script src="//js.pusher.com/2.2/pusher.min.js"></script>
  <% if user_signed_in? %>
  <script type="text/javascript" charset="utf-8">
  var pusher = new Pusher('<%= Pusher.key %>');
  var channel = pusher.subscribe('private-<%= current_user.id %>');
  channel.bind('notification', function(data) {
    dom_notify(data.message);
    $.ajax({
      type: 'GET',
      url: '/notifications/get_notifications_for_bubble',
      dataType: 'json',
      success:  function(bubble){ 
        $('.notification-bubble').remove();
        if (bubble.length > 0) {
          $('#notification-bell').after("<div class='notification-bubble'>" + bubble.length + "</div>");
        } 
      }
    });

    $.ajax({
      type: 'GET',
      url: '/notifications/get_notifications_for_header',
      dataType: 'json',
      success:  function(data){ 
        $('#notification-dropdown').html("");
        $.each( data, function( key, array ) {
          $('#notification-dropdown').append('<li class="notification"><a href="/notifications/' + array["id"] + '/dismiss_and_view"><div class="notify-block"><div class="notify-img">img' + array["image"] + '</div><p>'+ array["content"] +'</p></div></a></li>');

          
          if (array["dismissed"]) {
            $('#notification-dropdown:last-child').addClass("not-dismissed");
          }                        
        });
        $('#notification-dropdown').append('<a class="see-all" href="/notifications">See All</a>');        
      }
    });          
  });                    

function dom_notify(msg) {
  $('#notification-window').text(msg);
  $('#notification-window').fadeIn();
  setTimeout(function() {
    $('#notification-window').fadeOut();
  }, 4000);
}
</script>
<% end %>
  
  <script type="text/javascript" src="//use.typekit.net/kqu8wnu.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <script type="text/javascript" src="http://cdn.dev.skype.com/uri/skype-uri.js"></script>
</head>
<body>

<% if user_signed_in? %>
    <%= render 'layouts/user_header' %>
<% else %>
    <%= render 'layouts/home_header' %>
<% end %>


<!-- Jumbotron for landing page -->
<%= render  "static/jumbotron"  if controller_name == "static" && action_name == "index"  %>

<!-- Jumbotron for about page -->
<%= render  "static/jumbotronabout"  if controller_name == "static" && action_name == "about"  %>

<!-- Dashboard layout when signed in -->
<% if user_signed_in? %>
	<%= render 'layouts/user_sidenav' %>
<% end %>


<!-- Container for static pages -->
<!--<%= render  "static/container"  if controller_name == "static"%>-->
<%= yield %>
<!--<% if controller_name == "static" %>
	</div>
</div>-->
<% end %>
<% if user_signed_in? %>
<% else %>
    <%= render  "static/footer" %>
<% end %>

</body>
</html>
