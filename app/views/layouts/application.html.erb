<!DOCTYPE html>
<html>
<head>
  <title>Mandarin Minds</title>
  <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
  <%= csrf_meta_tags %>
  <link rel="shortcut icon" href="http://www.mandarinminds.com/favicon.ico?v=2" />
  <script src="//js.pusher.com/2.2/pusher.min.js"></script>
  <% if user_signed_in? %>
  <%= javascript_include_tag 'jquery.timeago' %>
  <script type="text/javascript" charset="utf-8">
  jQuery(document).ready(function() {
    jQuery("span.timeago").timeago();
  });
  var pusher = new Pusher('<%= Pusher.key %>');
  var channel = pusher.subscribe('private-<%= current_user.id %>');
  
  channel.bind('notification', function(data) {
    notification_alert(data);
    //getNextLesson();      
    $.ajax({
      type: 'GET',
      url: '/notifications/get_notifications_for_bubble',
      dataType: 'json',
      success:  function(bubble){ 
        $('.notification-bubble').remove();
        if (bubble.length > 0) {
          $('#notification-bell').after("<div class='notification-bubble'>" + bubble.length + "</div>");
        } 
      }
    });

    $.ajax({
      type: 'GET',
      url: '/notifications/get_notifications_for_header',
      dataType: 'json',
      success:  function(data){ 
        $('#notification-dropdown').html("");
        $.each( data, function(key, array){
          var str = '<li class="notification"><div class="notify-block row">';

          if (array["link"])  {
            str = str + '<a href='+array["link"]+'>';
          }

          str = str + '<div class="notify-img col-xs-2">'+array["image"]+'</div><div class="col-xs-10"><p style="padding-left: 3px">'+array["content"]+'</p><span style="font-size: 10px; color:black;position: absolute; right: -40px; bottom: -8px;">'+array["created_at"]+'</span></div>';

          if (array["link"])  {
            str = str + '</a>';
          }

          $('#notification-dropdown').append(str + '</div></li>');            
        });
        $('#notification-dropdown').append('<a class="see-all" href="/notifications">See All</a>');   
      }       
    });    

           
  }); 


     


function notification_alert(msg) {
  var str = msg["content"];
  if(str && str.length > 150) str = str.substring(0,150) + "...";
  $('#notification-window').text(str);
  $('#notification-window').fadeIn();
  setTimeout(function() {
    $('#notification-window').fadeOut();
  }, 10000);
}
</script>
<% end %>
  <script src="//use.typekit.net/kqu8wnu.js"></script>
  <script>try{Typekit.load();}catch(e){}</script>
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <!--<script type="text/javascript" src="http://cdn.dev.skype.com/uri/skype-uri.js"></script>-->
</head>



<% if user_signed_in? %>
	<body class="private">
    <%= render 'layouts/user_header' %>
<% else %>
	<body class="public">
    <%= render 'layouts/home_header' %>
<% end %>


<!-- Jumbotron for landing page -->
<%= render  "static/jumbotron"  if controller_name == "static" && action_name == "index"  %>

<!-- Jumbotron for about page -->
<%= render  "static/jumbotronabout"  if controller_name == "static" && action_name == "what-we-offer"  %>

<!-- Dashboard layout when signed in -->
<% if user_signed_in? %>
	<%= render 'layouts/user_sidenav' %>
<% end %>

 <!-- Flash message for all pages. Remove from individual pages --> 
<% flash.each do |type, message| %>
  <div class="alert alert-info fade-in">
    <button class="close" data-dismiss="alert">Ã—</button>
    <%= message %>
  </div>
<% end %>

<%= yield %>

<% if user_signed_in? %>
	</div>
	</div>
<% else %>
    <%= render  "static/footer" %>
<% end %>
</body>
</html>








