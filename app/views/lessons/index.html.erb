<h1>Listing lessons</h1>
<% if current_user.role_id == 2 %>
<h2> You are a Teacher</h2>
<p><%= link_to 'New Lesson', new_lesson_path %></p>

<p>Your current lessons:</p>

<strong>Booked</strong>
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>Start Time</th>
    </tr>
  </thead>
<% current_user.lessons_to_teach.where(student: nil).order(starts_at: :asc).each do |lesson| %>
<tr>
      <td><%= lesson.starts_at.strftime("%d/%m/%y") %></td>
      <td><%= lesson.starts_at.in_time_zone("Perth").strftime("%l:%M%P")%></td>
      <td><%= link_to 'Show ', lesson %></td>
      <td><%= link_to 'Edit ', edit_lesson_path(lesson) %></td>
      <td><%= link_to 'Destroy', lesson, method: :delete, data: { confirm: 'Are you sure?' } %></td>
</tr>

<% end %>
</table></br>
<strong>Booked</strong>
<table>
  <thead>
    <tr>
      <th>Date </th>
      <th>Start Time </th>
      <th>Student </th>

    </tr>
  </thead>
<% current_user.lessons_to_teach.where.not(student: nil).order(starts_at: :asc).each do |lesson| %>
<tr>
      <td><%= lesson.starts_at.strftime("%d/%m/%y") %></td>
      <td><%= lesson.starts_at.in_time_zone("Perth").strftime("%l:%M%P")%></td>
      <td><%= "#{lesson.student.firstname} " + "#{lesson.student.lastname}" %></td>
      <td><%= link_to 'Show ', lesson %></td>
      <td><%= link_to 'Edit ', edit_lesson_path(lesson) %></td>
      <td><%= link_to 'Destroy', lesson, method: :delete, data: { confirm: 'Are you sure?' } %></td>
</tr>

<div id="lessons_calendar">
  <%= render partial: "teachercalendar", locals: {events: @lessons} %>
</div>

<% end %>
</table></br>
<% else %>
<h2> You are a Student</h2>
<p>You cannot add new lessons</p>

<div id="lessons_calendar">
  <%= render partial: "studentcalendar", locals: {events: @lessons} %>
</div>

<%end%>

<table>
  <thead>
    <tr>
      <th>Student</th>
      <th>Teacher</th>
      <th>Starts at</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @lessons.each do |lesson| %>
    <tr>
      <td><%= lesson.student %></td>
      <td><%= lesson.teacher %></td>
      <td><%= lesson.starts_at %></td>
      <td><%= link_to 'Show', lesson %></td>
      <td><%= link_to 'Edit', edit_lesson_path(lesson) %></td>
      <td><%= link_to 'Destroy', lesson, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    </tr>
    <% end %>
  </tbody>
</table>

<p><%= link_to 'New Lesson (Students wont see this)', new_lesson_path %></p>

<div id="lessons_calendar">
  <%= render partial: "calendar", locals: {events: @lessons} %>
</div>




